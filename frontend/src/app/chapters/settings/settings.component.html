<ion-content class="youtube-api-settings-content">
  <div class="settings-container scrollable">
    @if(userInfoSettings) {
      <div class="user-header">
        <div class="user-avatar">
          <img [src]="userInfoSettings.profilePictureUrl" alt="User Avatar" />
          <div class="online-indicator" [class.connected]="isApiConnected"></div>
        </div>
        <div class="user-info">
          <h2>{{ userInfoSettings.fullName || 'Not Connected' }}</h2>
          <p>YouTube Data API Settings</p>
          <ion-chip [color]="isApiConnected ? 'success' : 'danger'" size="small">
            <ion-icon [name]="isApiConnected ? 'checkmark-circle' : 'close-circle'" slot="start"></ion-icon>
            {{ isApiConnected ? 'Connected' : 'Disconnected' }}
          </ion-chip>
        </div>
        <div class="back-button-container">
          <ion-button fill="outline" color="primary" (click)="goBackToApp()" class="back-button">
            <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
            Back to App
          </ion-button>
        </div>
      </div>
    }

    <div class="settings-nav scrollable">
      <div class="nav-item" [class.active]="selectedMainSection === 'appearance'" (click)="selectMainSection('appearance')">
        <ion-icon name="color-palette-outline"></ion-icon>
        <span>Appearance</span>
      </div>
      <div class="nav-item" [class.active]="selectedMainSection === 'channel-info'" (click)="selectMainSection('channel-info')">
        <ion-icon name="person-circle-outline"></ion-icon>
        <span>Channel Info</span>
      </div>
      <div class="nav-item" [class.active]="selectedMainSection === 'search'" (click)="selectMainSection('search')">
        <ion-icon name="globe-outline"></ion-icon>
        <span>Search Preferences</span>
      </div>
      <div class="nav-item" [class.active]="selectedMainSection === 'playlists'" (click)="selectMainSection('playlists')">
        <ion-icon name="list-outline"></ion-icon>
        <span>Playlists</span>
        <ion-badge color="primary">{{ playlistCount }}</ion-badge>
      </div>
      <div class="nav-item" [class.active]="selectedMainSection === 'subscriptions'" (click)="selectMainSection('subscriptions')">
        <ion-icon name="people-outline"></ion-icon>
        <span>Subscriptions</span>
        <ion-badge color="secondary">{{ subscriptionCount }}</ion-badge>
      </div>
      <div class="nav-item" [class.active]="selectedMainSection === 'api-key'" (click)="selectMainSection('api-key')">
        <ion-icon name="key-outline"></ion-icon>
        <span>API Configuration</span>
      </div>
      <div class="nav-item" [class.active]="selectedMainSection === 'about'" (click)="selectMainSection('about')">
        <ion-icon name="information-circle-outline"></ion-icon>
        <span>About</span>
      </div>
    </div>

    <div class="settings-main scrollable">
      <div class="settings-header">
        <h1>{{ getSectionTitle() }}</h1>
        <div class="header-actions">
          <ion-button fill="outline" size="small" (click)="refreshData(selectedMainSection)" [disabled]="!isApiConnected || isLoading">
            <ion-icon name="refresh-outline" slot="start" [class.rotating]="isLoading"></ion-icon>
            Refresh
          </ion-button>
        </div>
      </div>

      <!-- Channel Information Section -->
      <div *ngIf="selectedMainSection === 'channel-info'" class="content-section channel-info">
        <div class="user-details" *ngIf="isApiConnected && channelInfoSettings">
          <div class="detail-row">
            <ion-icon name="person-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">Channel Name</span>
              <span class="value">{{ channelInfoSettings.name || 'Loading...' }}</span>
            </div>
          </div>
          <div class="detail-row">
            <ion-icon name="mail-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">URL</span>
              <span class="value">{{ channelInfoSettings.channelUrl || 'Not available' }}</span>
            </div>
          </div>
          <div class="detail-row">
            <ion-icon name="tv-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">Channel ID</span>
              <span class="value">{{ channelInfoSettings.channelId || 'Loading...' }}</span>
            </div>
          </div>
          <div class="detail-row">
            <ion-icon name="people-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">Subscribers</span>
              <span class="value">{{ formatNumber(channelInfoSettings.subscriberCount) }}</span>
            </div>
          </div>
          <div class="detail-row">
            <ion-icon name="videocam-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">Total Videos</span>
              <span class="value">{{ formatNumber(channelInfoSettings.videoCount) }}</span>
            </div>
          </div>
          <div class="detail-row">
            <ion-icon name="eye-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">Total Views</span>
              <span class="value">{{ formatNumber(channelInfoSettings.totalViews) }}</span>
            </div>
          </div>
          <div class="detail-row">
            <ion-icon name="calendar-outline"></ion-icon>
            <div class="detail-content">
              <span class="label">Joined</span>
              <span class="value">{{ channelInfoSettings.joinedDate || 'Not available' }}</span>
            </div>
          </div>
        </div>
        <div class="section-card" *ngIf="!isApiConnected">
          <div class="empty-state">
            <ion-icon name="cloud-offline-outline" size="large"></ion-icon>
            <p>Connect to YouTube API to view user information</p>
          </div>
        </div>
      </div>

      <!-- Appearance Section -->
      <div *ngIf="selectedMainSection === 'appearance' && appearanceSettings" class="content-section">
        <ion-list>
          <ion-item>
            <ion-icon name="color-palette-outline" slot="start"></ion-icon>
            <ion-label>Theme</ion-label>
            <ion-select [(ngModel)]="appearanceSettings.theme" (ionChange)="onThemeChange()" interface="popover">
              <ion-select-option value="default">Default</ion-select-option>
              <ion-select-option value="light">Light</ion-select-option>
              <ion-select-option value="dark">Dark</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-icon name="text-outline" slot="start"></ion-icon>
            <ion-label>Font Size</ion-label>
            <ion-select [(ngModel)]="appearanceSettings.fontSize" (ionChange)="onFontSizeChange()" interface="popover">
              <ion-select-option value="small">Small</ion-select-option>
              <ion-select-option value="medium">Medium</ion-select-option>
              <ion-select-option value="large">Large</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-icon name="image-outline" slot="start"></ion-icon>
            <ion-label>Thumbnail Size</ion-label>
            <ion-select [(ngModel)]="appearanceSettings.thumbnailSize" (ionChange)="onThumbnailSizeChange()" interface="popover">
              <ion-select-option value="small">Small</ion-select-option>
              <ion-select-option value="medium">Medium</ion-select-option>
              <ion-select-option value="large">Large</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-icon name="search-outline" slot="start"></ion-icon>
            <ion-label>Search Suggestions</ion-label>
            <ion-select [(ngModel)]="appearanceSettings.autoComplete" (ionChange)="onAutoCompleteChange()" interface="popover">
              <ion-select-option value="chips">Chips</ion-select-option>
              <ion-select-option value="dropdown">Dropdown</ion-select-option>
            </ion-select>
          </ion-item>
          <ion-item>
            <ion-icon name="document-text-outline" slot="start"></ion-icon>
            <ion-label>Show Descriptions</ion-label>
            <ion-toggle [(ngModel)]="appearanceSettings.displayDescription" (ionChange)="onDisplayDescriptionChange()"></ion-toggle>
          </ion-item>
          <ion-item>
            <ion-icon name="layers-outline" slot="start"></ion-icon>
            <ion-label>Show Backdrop Effects</ion-label>
            <ion-toggle [(ngModel)]="appearanceSettings.visibleBackdrop" (ionChange)="onBackdropChange()"></ion-toggle>
          </ion-item>
          <ion-item>
            <ion-icon name="search-outline" slot="start"></ion-icon>
            <ion-label>Display Results</ion-label>
            <ion-select [(ngModel)]="appearanceSettings.displayResults" (ionChange)="onDisplayResultsChange()" interface="popover">
              <ion-select-option value="change">On Change</ion-select-option>
              <ion-select-option value="search">On Search</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-list>
      </div>

      <!-- Search Preferences Section -->

      <div *ngIf="selectedMainSection === 'search' && searchSettings" class="content-section">
        <ion-list>
          <ion-item>
            <ion-icon name="server-outline" slot="start"></ion-icon>
            <ion-label>Max Items per Request</ion-label>
            <ion-select [(ngModel)]="searchSettings.maxItemsPerRequest" (ionChange)="onMaxItemsPerRequestChange()" interface="popover">
              <ion-select-option value="5">5</ion-select-option>
              <ion-select-option value="10">10</ion-select-option>
              <ion-select-option value="25">25</ion-select-option>
            </ion-select>
          </ion-item>

          <!-- Country/Region Select -->
          <ion-item class="region-item">
            <ion-icon name="flag-outline" slot="start"></ion-icon>
            <ion-label class="main-label">
              Country/Language
              <br><small class="subtext"
                *ngIf="searchSettings.country && searchSettings.language">
                Selected: {{ searchSettings.country.nativeName || '...' }}/{{ searchSettings.language.name || '...' }}
              </small>
            </ion-label>
            <div class="action-buttons">
              <ion-button
                fill="clear"
                (click)="openCountryModal()"
                class="search-button">
                <ion-icon name="search-outline"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
          <ion-item>
            <ion-icon name="color-palette-outline" slot="start"></ion-icon>
            <ion-label>SafeSearch</ion-label>
            <ion-select [(ngModel)]="searchSettings.safeSearch" (ionChange)="onSafeSearchChange()" interface="popover">
              <ion-select-option value="none">None</ion-select-option>
              <ion-select-option value="moderate">Moderate</ion-select-option>
              <ion-select-option value="strict">Strict</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-list>
      </div>

      <!-- Playlists Section -->
      <div *ngIf="selectedMainSection === 'playlists' && playlistsSettings" class="content-section">
        <app-grid *ngIf="isApiConnected"
          [data]="playlistTable"
          [columns]="[
            { key: 'name', label: 'Title', sortable: true, type: 'text', size: '5' },
            { key: 'videoCount', label: 'Videos', sortable: true, type: 'text', size: '5' }
          ]"
          [pageSize]="10"
          [showActions]="true"
          (add)="createPlaylist($event)"
          (edit)="onEditPlaylist($event)"
          (delete)="onDeletePlaylist($event)">
        </app-grid>
        <div class="section-card" *ngIf="!isApiConnected">
          <div class="empty-state">
            <ion-icon name="list-outline" size="large"></ion-icon>
            <p>Connect to YouTube API to manage playlists</p>
          </div>
        </div>
      </div>

      <!-- Subscriptions Section -->
      <div *ngIf="selectedMainSection === 'subscriptions' && subscriptionsSettings" class="content-section">
        <app-grid *ngIf="isApiConnected"
          [data]="subscriptionTable"
          [columns]="[
            { key: 'name', label: 'Channel', sortable: true, type: 'text', size: '5' },
            { key: 'subscriberCount', label: 'Subscribers', sortable: true, type: 'text', size: '5' }
          ]"
          [pageSize]="10"
          [showActions]="true"
          (pageChange)="loadSubscriptions($event.page - 1)"
        >
        </app-grid>
        <div class="section-card" *ngIf="!isApiConnected">
          <div class="empty-state">
            <ion-icon name="people-outline" size="large"></ion-icon>
            <p>Connect to YouTube API to view subscriptions</p>
          </div>
        </div>
      </div>

      <!-- API Configuration Section -->
      <div *ngIf="selectedMainSection === 'api-key' && apiConfigSettings" class="content-section">
        <div class="section-card">
          <ion-list>
            <ion-item>
              <ion-icon name="key-outline" slot="start"></ion-icon>
              <ion-input label="YouTube API Key" labelPlacement="stacked" [(ngModel)]="apiConfigSettings.apiKey"
                [type]="showApiKey ? 'text' : 'password'" placeholder="Enter your YouTube Data API key"></ion-input>
              <ion-button fill="clear" slot="end" (click)="toggleApiKeyVisibility()">
                <ion-icon [name]="showApiKey ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
              </ion-button>
            </ion-item>
            <ion-item>
              <ion-icon name="person-circle-outline" slot="start"></ion-icon>
              <ion-input label="Client ID (Optional)" labelPlacement="stacked" [(ngModel)]="apiConfigSettings.clientId"
                placeholder="OAuth 2.0 Client ID"></ion-input>
            </ion-item>
            <ion-item>
              <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
              <ion-input label="Client Secret (Optional)" labelPlacement="stacked" [(ngModel)]="apiConfigSettings.clientSecret"
                [type]="showClientSecret ? 'text' : 'password'" placeholder="OAuth 2.0 Client Secret"></ion-input>
              <ion-button fill="clear" slot="end" (click)="toggleClientSecretVisibility()">
                <ion-icon [name]="showClientSecret ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
        </div>
        <div class="section-card">
          <div class="card-header">
            <h3>Quota Usage</h3>
          </div>
          <div class="quota-info">
            <div class="quota-bar">
              <div class="quota-progress" [style.width.%]="getQuotaPercentage()"></div>
            </div>
            <div class="quota-text">
              <span>{{ formatNumber(apiConfigSettings.quotaUsage) }} / {{ formatNumber(apiConfigSettings.quotaLimit) }}</span>
              <span>({{ getQuotaPercentage() }}% used)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- About Section -->
      <div *ngIf="selectedMainSection === 'about' && aboutSettings" class="content-section about-info">
        <div class="app-info">
          <img src="assets/logo-no-bg.png" alt="App Logo" class="app-logo" />
          <h4>YouTube API Manager</h4>
          <p>Version {{ aboutSettings.appVersion }}</p>
          <p>A powerful tool for managing your YouTube channel through the YouTube Data API.</p>
        </div>
        <div class="about-details">
          <div class="description">
            <div class="detail-row">
              <ion-icon name="code-outline"></ion-icon>
              <div class="detail-content">
                <span class="label">Developed By</span>
                <span class="value">{{ aboutSettings.developerInfo }}</span>
              </div>
            </div>
            <div class="detail-row">
              <ion-icon name="calendar-outline"></ion-icon>
              <div class="detail-content">
                <span class="label">Release Date</span>
                <span class="value">{{ aboutSettings.releaseDate }}</span>
              </div>
            </div>
            <div class="detail-row">
              <ion-icon name="document-text-outline"></ion-icon>
              <div class="detail-content">
                <span class="label">License</span>
                <span class="value">{{ aboutSettings.licenseInfo }}</span>
              </div>
            </div>
          </div>
          <div class="action-buttons">
            <ion-button expand="block" fill="outline" size="small" (click)="openWebsite()">
              <ion-icon name="globe-outline" slot="start"></ion-icon>
              Visit Website
            </ion-button>
            <ion-button expand="block" fill="outline" size="small" (click)="openPrivacyPolicy()">
              <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
              Privacy Policy
            </ion-button>
          </div>
        </div>
      </div>

      <div *ngIf="!selectedMainSection" class="empty-state">
        <ion-icon name="settings-outline" size="large"></ion-icon>
        <p class="empty-state-message">Select a category from the left menu to view YouTube API settings.</p>
      </div>
    </div>
  </div>
</ion-content>
